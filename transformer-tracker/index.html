<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Supply Chain Intelligence â€” Prospector Labs</title>
    <link href="https://cdn.jsdelivr.net/npm/geist@1.2.0/dist/fonts/geist-sans/style.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/geist@1.2.0/dist/fonts/geist-mono/style.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --bg-elevated: #1f1f1f;
            --border: #2a2a2a;
            --border-hover: #3a3a3a;
            --text-primary: #fafafa;
            --text-secondary: #a1a1a1;
            --text-muted: #6a6a6a;
            --accent-blue: #3b82f6;
            --accent-cyan: #22d3ee;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-orange: #f97316;
            --accent-red: #ef4444;
            --accent-purple: #a855f7;
            --gradient-blue: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        
        body {
            font-family: 'Geist', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }
        
        /* Header Bar */
        .header-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-blue);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        
        .logo-text {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }
        
        .logo-text span {
            color: var(--text-muted);
            font-weight: 400;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Geist Mono', monospace;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 0 4px rgba(16, 185, 129, 0); }
        }
        
        /* Main Layout */
        .main-container {
            display: flex;
            min-height: calc(100vh - 57px);
        }
        
        /* Sidebar Navigation */
        .sidebar {
            width: 200px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px 0;
            position: sticky;
            top: 57px;
            height: calc(100vh - 57px);
            overflow-y: auto;
        }
        
        .nav-section {
            padding: 0 12px;
            margin-bottom: 8px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            font-size: 13px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 4px;
        }
        
        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background: var(--accent-blue);
            color: white;
        }
        
        .nav-icon {
            width: 18px;
            height: 18px;
            opacity: 0.7;
        }
        
        .nav-item.active .nav-icon {
            opacity: 1;
        }
        
        /* Content Area */
        .content {
            flex: 1;
            padding: 24px 32px;
            max-width: 1400px;
        }
        
        /* Section Headers */
        .section-header {
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: -0.03em;
            margin-bottom: 8px;
        }
        
        .section-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-blue);
        }
        
        .stat-card.warning::before { background: var(--accent-yellow); }
        .stat-card.danger::before { background: var(--accent-red); }
        .stat-card.success::before { background: var(--accent-green); }
        
        .stat-value {
            font-size: 32px;
            font-weight: 600;
            font-family: 'Geist Mono', monospace;
            line-height: 1.1;
            margin-bottom: 4px;
        }
        
        .stat-value.blue { color: var(--accent-blue); }
        .stat-value.yellow { color: var(--accent-yellow); }
        .stat-value.red { color: var(--accent-red); }
        .stat-value.green { color: var(--accent-green); }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            font-family: 'Geist Mono', monospace;
            margin-top: 8px;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .stat-change.up {
            color: var(--accent-red);
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Chart Containers */
        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .chart-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .chart-legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }
        
        /* Sankey Diagram */
        .sankey-container {
            width: 100%;
            min-height: 400px;
        }
        
        .sankey-container svg {
            width: 100%;
            height: 100%;
        }
        
        .sankey-node rect {
            fill-opacity: 0.9;
            stroke: none;
        }
        
        .sankey-node text {
            font-family: 'Geist', sans-serif;
            font-size: 11px;
            fill: var(--text-primary);
        }
        
        .sankey-link {
            fill: none;
            stroke-opacity: 0.3;
        }
        
        .sankey-link:hover {
            stroke-opacity: 0.6;
        }
        
        /* Treemap */
        .treemap-container {
            width: 100%;
            height: 280px;
        }
        
        .treemap-cell {
            stroke: var(--bg-primary);
            stroke-width: 2px;
        }
        
        .treemap-label {
            font-family: 'Geist', sans-serif;
            font-size: 11px;
            fill: white;
            pointer-events: none;
        }
        
        /* Lead Time Bars */
        .lead-time-chart {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        
        .lead-time-row {
            display: grid;
            grid-template-columns: 160px 1fr 60px;
            align-items: center;
            gap: 16px;
        }
        
        .lead-time-label {
            font-size: 13px;
            font-weight: 500;
        }
        
        .lead-time-label small {
            display: block;
            font-size: 11px;
            font-weight: 400;
            color: var(--text-muted);
        }
        
        .lead-time-track {
            height: 28px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .lead-time-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 11px;
            font-family: 'Geist Mono', monospace;
            color: white;
            position: relative;
        }
        
        .lead-time-segment.current {
            background: var(--accent-blue);
        }
        
        .lead-time-value {
            font-size: 13px;
            font-weight: 600;
            font-family: 'Geist Mono', monospace;
            text-align: right;
            color: var(--text-secondary);
        }
        
        /* Import Dependency Badges */
        .import-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-family: 'Geist Mono', monospace;
            font-weight: 600;
        }
        
        .import-badge.critical {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .import-badge.high {
            background: rgba(249, 115, 22, 0.15);
            color: var(--accent-orange);
            border: 1px solid rgba(249, 115, 22, 0.3);
        }
        
        .import-badge.medium {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-yellow);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .import-badge.low {
            background: rgba(16, 185, 129, 0.15);
            color: var(--accent-green);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        /* Bottleneck Cards */
        .bottleneck-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }
        
        .bottleneck-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 18px;
            position: relative;
        }
        
        .bottleneck-severity {
            position: absolute;
            top: 14px;
            right: 14px;
            display: flex;
            gap: 3px;
        }
        
        .severity-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--bg-tertiary);
        }
        
        .severity-dot.active {
            background: var(--accent-red);
        }
        
        .severity-dot.warning {
            background: var(--accent-yellow);
        }
        
        .bottleneck-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            padding-right: 70px;
        }
        
        .bottleneck-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Two Column Layout */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        @media (max-width: 1200px) {
            .two-col {
                grid-template-columns: 1fr;
            }
        }
        
        /* Filter Tabs */
        .filter-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }
        
        .filter-tab {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.15s;
        }
        
        .filter-tab:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }
        
        .filter-tab.active {
            color: var(--accent-blue);
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        /* Equipment Cards */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }
        
        .equipment-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            transition: border-color 0.15s;
        }
        
        .equipment-card:hover {
            border-color: var(--border-hover);
        }
        
        .equipment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .equipment-name {
            font-size: 15px;
            font-weight: 600;
        }
        
        .equipment-meta {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .equipment-tag {
            font-size: 10px;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            padding: 3px 8px;
            border-radius: 4px;
        }
        
        .equipment-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .equipment-stat {
            text-align: center;
            padding: 10px 6px;
            background: var(--bg-tertiary);
            border-radius: 6px;
        }
        
        .equipment-stat-value {
            font-size: 16px;
            font-weight: 600;
            font-family: 'Geist Mono', monospace;
            color: var(--accent-blue);
        }
        
        .equipment-stat-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Material Flow Cards */
        .material-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .material-name {
            font-size: 17px;
            font-weight: 600;
        }
        
        .material-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .material-stat {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }
        
        .material-stat-value {
            font-size: 18px;
            font-weight: 600;
            font-family: 'Geist Mono', monospace;
            color: var(--accent-blue);
        }
        
        .material-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Supplier List */
        .supplier-list {
            border-top: 1px solid var(--border);
            padding-top: 12px;
        }
        
        .supplier-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .supplier-row:last-child {
            border-bottom: none;
        }
        
        .supplier-name {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .supplier-country {
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .supplier-share {
            font-size: 13px;
            font-weight: 600;
            font-family: 'Geist Mono', monospace;
            color: var(--accent-cyan);
        }
        
        /* Info Boxes */
        .info-box {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 14px;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 16px;
            line-height: 1.5;
        }
        
        .info-box strong {
            color: var(--text-primary);
        }
        
        .info-box.warning {
            border-left: 3px solid var(--accent-yellow);
        }
        
        .info-box.danger {
            border-left: 3px solid var(--accent-red);
        }
        
        /* Capacity Gap */
        .capacity-gap {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .capacity-bar-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .capacity-label {
            width: 100px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .capacity-bar {
            flex: 1;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .capacity-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 11px;
            font-family: 'Geist Mono', monospace;
            color: white;
        }
        
        .capacity-demand {
            background: var(--accent-blue);
        }
        
        .capacity-supply {
            background: var(--accent-green);
        }
        
        .capacity-gap-indicator {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                rgba(239, 68, 68, 0.3),
                rgba(239, 68, 68, 0.3) 5px,
                transparent 5px,
                transparent 10px
            );
        }
        
        /* Responsive */
        @media (max-width: 900px) {
            .sidebar {
                display: none;
            }
            
            .content {
                padding: 16px;
            }
            
            .lead-time-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-hover);
        }
    </style>
</head>
<body>
    <!-- Header Bar -->
    <header class="header-bar">
        <div class="logo">
            <div class="logo-icon">âš¡</div>
            <div class="logo-text">Grid Supply Chain <span>by Prospector Labs</span></div>
        </div>
        <div class="header-right">
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span>February 2026</span>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="nav-section">
                <div class="nav-item active" data-tab="overview">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                    Overview
                </div>
                <div class="nav-item" data-tab="equipment">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v10M1 12h6m6 0h10"/></svg>
                    Grid Equipment
                </div>
                <div class="nav-item" data-tab="materials">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/></svg>
                    Materials
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="content">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="section-header">
                    <h1 class="section-title">US Grid Equipment Market</h1>
                    <p class="section-subtitle">Supply chain intelligence for electrical grid infrastructure</p>
                </div>
                
                <!-- Key Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value blue">$85B</div>
                        <div class="stat-label">Total US Market (2025)</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-value yellow">36</div>
                        <div class="stat-label">Months â€” LPT Lead Time</div>
                        <div class="stat-change up">â†‘ 140% vs pre-2020</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-value red">70%</div>
                        <div class="stat-label">GOES Import Dependency</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value green">2,600</div>
                        <div class="stat-label">GW Interconnection Queue</div>
                    </div>
                </div>
                
                <!-- Market Flow Sankey -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">US Grid Equipment Market Flow</div>
                            <div class="chart-subtitle">Equipment categories â†’ Import vs Domestic ($B)</div>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item"><div class="legend-dot" style="background: var(--accent-green)"></div>Domestic</div>
                            <div class="legend-item"><div class="legend-dot" style="background: var(--accent-orange)"></div>Imported</div>
                        </div>
                    </div>
                    <div id="market-sankey" class="sankey-container" style="height: 380px;"></div>
                </div>
                
                <!-- Two Column: Import Dependency + Capacity Gap -->
                <div class="two-col">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <div class="chart-title">Import Dependency by Category</div>
                                <div class="chart-subtitle">Percentage sourced from imports</div>
                            </div>
                        </div>
                        <div id="import-treemap" class="treemap-container"></div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <div class="chart-title">LPT Capacity Gap</div>
                                <div class="chart-subtitle">US demand vs domestic manufacturing</div>
                            </div>
                        </div>
                        <div class="capacity-gap">
                            <div class="capacity-bar-container">
                                <div class="capacity-label">Annual Demand</div>
                                <div class="capacity-bar">
                                    <div class="capacity-fill capacity-demand" style="width: 100%;">200 units</div>
                                </div>
                            </div>
                            <div class="capacity-bar-container">
                                <div class="capacity-label">US Capacity</div>
                                <div class="capacity-bar">
                                    <div class="capacity-fill capacity-supply" style="width: 75%;">150 units</div>
                                    <div class="capacity-gap-indicator" style="width: 25%;"></div>
                                </div>
                            </div>
                            <div class="info-box warning" style="margin-top: 16px;">
                                <strong>50 unit gap</strong> â€” filled by imports from Germany, Japan, South Korea, Mexico. Hyundai (AL) adds 24 units/year in 2025.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Critical Bottlenecks -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Critical Supply Chain Bottlenecks</div>
                            <div class="chart-subtitle">Key constraints limiting US grid equipment production</div>
                        </div>
                    </div>
                    <div class="bottleneck-grid">
                        <div class="bottleneck-card">
                            <div class="bottleneck-severity">
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                            </div>
                            <div class="bottleneck-name">GOES Steel</div>
                            <div class="bottleneck-desc">Grain-oriented electrical steel for transformer cores. US 70% import dependent. Only one US producer (Cleveland-Cliffs).</div>
                        </div>
                        <div class="bottleneck-card">
                            <div class="bottleneck-severity">
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                            </div>
                            <div class="bottleneck-name">LPT Manufacturing</div>
                            <div class="bottleneck-desc">Only 6 US facilities can produce large power transformers. New facilities require $100M+ and 2+ years to build.</div>
                        </div>
                        <div class="bottleneck-card">
                            <div class="bottleneck-severity">
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot"></div>
                            </div>
                            <div class="bottleneck-name">HV Bushings</div>
                            <div class="bottleneck-desc">Critical transformer component. ~60% imported. Limited qualified global suppliers. Long qualification process.</div>
                        </div>
                        <div class="bottleneck-card">
                            <div class="bottleneck-severity">
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot active"></div>
                                <div class="severity-dot"></div>
                            </div>
                            <div class="bottleneck-name">Skilled Labor</div>
                            <div class="bottleneck-desc">2-5 year training for transformer manufacturing. 30% of workforce retiring in next decade.</div>
                        </div>
                        <div class="bottleneck-card">
                            <div class="bottleneck-severity">
                                <div class="severity-dot warning"></div>
                                <div class="severity-dot warning"></div>
                                <div class="severity-dot warning"></div>
                                <div class="severity-dot"></div>
                                <div class="severity-dot"></div>
                            </div>
                            <div class="bottleneck-name">Copper Supply</div>
                            <div class="bottleneck-desc">Competition from EV and renewables. Potential 5-10M ton supply gap by 2030. Prices up 15% YoY.</div>
                        </div>
                        <div class="bottleneck-card">
                            <div class="bottleneck-severity">
                                <div class="severity-dot warning"></div>
                                <div class="severity-dot warning"></div>
                                <div class="severity-dot warning"></div>
                                <div class="severity-dot"></div>
                                <div class="severity-dot"></div>
                            </div>
                            <div class="bottleneck-name">SF6 Regulations</div>
                            <div class="bottleneck-desc">EU F-gas phase-out. California restrictions. GWP of 23,500. Alternatives still maturing for HV.</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Grid Equipment Tab -->
            <div id="equipment" class="tab-content">
                <div class="section-header">
                    <h1 class="section-title">Grid Equipment</h1>
                    <p class="section-subtitle">Transformers, switchgear, cables, and key components</p>
                </div>
                
                <!-- Filter Tabs -->
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">All Equipment</button>
                    <button class="filter-tab" data-filter="transformers">Transformers</button>
                    <button class="filter-tab" data-filter="switchgear">Switchgear</button>
                    <button class="filter-tab" data-filter="cables">Cables</button>
                </div>
                
                <!-- Equipment Cards Grid -->
                <div class="equipment-grid" id="equipment-grid">
                    <!-- Populated by JS -->
                </div>
                
                <!-- Lead Times Chart -->
                <div class="chart-container" style="margin-top: 24px;">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Current Lead Times</div>
                            <div class="chart-subtitle">Quoted lead times by equipment category</div>
                        </div>
                    </div>
                    <div id="lead-times-chart" class="lead-time-chart"></div>
                </div>
                
                <!-- Supply Flow Sankey -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">LPT Supply Flow</div>
                            <div class="chart-subtitle">Source countries â†’ US end users</div>
                        </div>
                    </div>
                    <div id="equipment-sankey" class="sankey-container" style="height: 350px;"></div>
                </div>
            </div>
            
            <!-- Materials Tab -->
            <div id="materials" class="tab-content">
                <div class="section-header">
                    <h1 class="section-title">Materials Supply Chain</h1>
                    <p class="section-subtitle">Critical raw materials for grid infrastructure manufacturing</p>
                </div>
                
                <!-- GOES -->
                <div class="material-card">
                    <div class="material-header">
                        <div class="material-name">GOES (Grain-Oriented Electrical Steel)</div>
                        <span class="import-badge critical">70% Import</span>
                    </div>
                    <div class="material-stats">
                        <div class="material-stat">
                            <div class="material-stat-value">250K</div>
                            <div class="material-stat-label">Tons/Year (US)</div>
                        </div>
                        <div class="material-stat">
                            <div class="material-stat-value">$3.5-4.5K</div>
                            <div class="material-stat-label">Per Ton</div>
                        </div>
                        <div class="material-stat">
                            <div class="material-stat-value">1</div>
                            <div class="material-stat-label">US Producer</div>
                        </div>
                    </div>
                    <div id="goes-sankey" class="sankey-container" style="height: 200px;"></div>
                    <div class="supplier-list">
                        <div class="supplier-row">
                            <div><span class="supplier-name">Nippon Steel</span> <span class="supplier-country">Japan</span></div>
                            <div class="supplier-share">~25%</div>
                        </div>
                        <div class="supplier-row">
                            <div><span class="supplier-name">Baowu Steel</span> <span class="supplier-country">China</span></div>
                            <div class="supplier-share">~20%</div>
                        </div>
                        <div class="supplier-row">
                            <div><span class="supplier-name">JFE Steel</span> <span class="supplier-country">Japan</span></div>
                            <div class="supplier-share">~15%</div>
                        </div>
                        <div class="supplier-row">
                            <div><span class="supplier-name">Cleveland-Cliffs</span> <span class="supplier-country">USA ðŸ‡ºðŸ‡¸</span></div>
                            <div class="supplier-share">~8%</div>
                        </div>
                    </div>
                    <div class="info-box danger" style="margin-top: 16px;">
                        <strong>Single Point of Failure:</strong> Cleveland-Cliffs is the only US GOES producer. Section 232 tariffs (25%) apply to imports.
                    </div>
                </div>
                
                <!-- Copper -->
                <div class="material-card">
                    <div class="material-header">
                        <div class="material-name">Copper (Winding & Conductor Grade)</div>
                        <span class="import-badge medium">Medium Risk</span>
                    </div>
                    <div class="material-stats">
                        <div class="material-stat">
                            <div class="material-stat-value">2.8M</div>
                            <div class="material-stat-label">Tons/Year (US Grid)</div>
                        </div>
                        <div class="material-stat">
                            <div class="material-stat-value">$8.5-9.5K</div>
                            <div class="material-stat-label">Per Ton (LME)</div>
                        </div>
                        <div class="material-stat">
                            <div class="material-stat-value" style="color: var(--accent-red);">â†‘15%</div>
                            <div class="material-stat-label">YoY Price</div>
                        </div>
                    </div>
                    <div class="supplier-list">
                        <div class="supplier-row">
                            <div><span class="supplier-name">Chile</span> <span class="supplier-country">(Codelco)</span></div>
                            <div class="supplier-share">27% global</div>
                        </div>
                        <div class="supplier-row">
                            <div><span class="supplier-name">Peru</span></div>
                            <div class="supplier-share">10% global</div>
                        </div>
                        <div class="supplier-row">
                            <div><span class="supplier-name">USA</span> <span class="supplier-country">(Freeport-McMoRan)</span></div>
                            <div class="supplier-share">6% global</div>
                        </div>
                    </div>
                    <div class="info-box warning" style="margin-top: 16px;">
                        <strong>Competition Intensifying:</strong> EV sector, data centers, and renewables all competing for copper. Potential 5-10M ton supply gap by 2030.
                    </div>
                </div>
                
                <!-- SF6 -->
                <div class="material-card">
                    <div class="material-header">
                        <div class="material-name">SF6 (Sulfur Hexafluoride)</div>
                        <span class="import-badge high">Regulatory Risk</span>
                    </div>
                    <div class="material-stats">
                        <div class="material-stat">
                            <div class="material-stat-value">9K</div>
                            <div class="material-stat-label">Tons/Year (US)</div>
                        </div>
                        <div class="material-stat">
                            <div class="material-stat-value">$15-25</div>
                            <div class="material-stat-label">Per kg</div>
                        </div>
                        <div class="material-stat">
                            <div class="material-stat-value" style="color: var(--accent-red);">23,500</div>
                            <div class="material-stat-label">GWP</div>
                        </div>
                    </div>
                    <div class="supplier-list">
                        <div class="supplier-row">
                            <div><span class="supplier-name">Chinese Producers</span></div>
                            <div class="supplier-share">~30%</div>
                        </div>
                        <div class="supplier-row">
                            <div><span class="supplier-name">Solvay</span> <span class="supplier-country">Belgium</span></div>
                            <div class="supplier-share">~20%</div>
                        </div>
                        <div class="supplier-row">
                            <div><span class="supplier-name">Honeywell</span> <span class="supplier-country">USA ðŸ‡ºðŸ‡¸</span></div>
                            <div class="supplier-share">~15%</div>
                        </div>
                    </div>
                    <div class="info-box warning" style="margin-top: 16px;">
                        <strong>Phase-Out Underway:</strong> EU F-gas Regulation targeting elimination. California restrictions active. Alternatives (g3, vacuum) gaining traction.
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Equipment Data
        const equipmentData = [
            // Transformers
            { category: 'transformers', name: 'Large Power (LPT)', size: '100-400+ MVA', market: '$3.2B', import: 75, leadTime: '30-42', leadAvg: 36 },
            { category: 'transformers', name: 'Generator Step-Up', size: '200-1000+ MVA', market: '$2.1B', import: 81, leadTime: '36-48', leadAvg: 42 },
            { category: 'transformers', name: 'Medium Power', size: '10-100 MVA', market: '$4.8B', import: 68, leadTime: '18-26', leadAvg: 22 },
            { category: 'transformers', name: 'Distribution', size: '<5 MVA', market: '$17.9B', import: 70, leadTime: '8-14', leadAvg: 11 },
            // Switchgear
            { category: 'switchgear', name: 'Gas Insulated (GIS)', size: '145-550 kV', market: '$8.5B', import: 78, leadTime: '18-30', leadAvg: 24 },
            { category: 'switchgear', name: 'Air Insulated (AIS)', size: '145-550 kV', market: '$5.2B', import: 65, leadTime: '12-24', leadAvg: 18 },
            { category: 'switchgear', name: 'HV Circuit Breakers', size: '145+ kV', market: '$4.8B', import: 72, leadTime: '14-26', leadAvg: 20 },
            // Cables
            { category: 'cables', name: 'HVDC Submarine', size: '320-525 kV DC', market: '$4.2B', import: 90, leadTime: '32-52', leadAvg: 42 },
            { category: 'cables', name: 'Underground XLPE', size: '138-345 kV', market: '$5.8B', import: 40, leadTime: '12-24', leadAvg: 18 },
            { category: 'cables', name: 'Overhead Conductors', size: 'ACSR/HTLS', market: '$8.0B', import: 0, leadTime: '4-12', leadAvg: 8 },
        ];
        
        // Lead time chart data
        const leadTimeData = [
            { name: 'HVDC Submarine', size: '320-525 kV DC', min: 32, max: 52, avg: 42, color: 'var(--accent-red)' },
            { name: 'GSU Transformer', size: '200-1000+ MVA', min: 36, max: 48, avg: 42, color: 'var(--accent-red)' },
            { name: 'Large Power (LPT)', size: '100-400 MVA', min: 30, max: 42, avg: 36, color: 'var(--accent-orange)' },
            { name: 'GIS Switchgear', size: '145-550 kV', min: 18, max: 30, avg: 24, color: 'var(--accent-blue)' },
            { name: 'Medium Power Xfmr', size: '10-100 MVA', min: 18, max: 26, avg: 22, color: 'var(--accent-blue)' },
            { name: 'HV Circuit Breakers', size: '145+ kV', min: 14, max: 26, avg: 20, color: 'var(--accent-blue)' },
            { name: 'Underground XLPE', size: '138-345 kV', min: 12, max: 24, avg: 18, color: 'var(--accent-blue)' },
            { name: 'Distribution Xfmr', size: '<5 MVA', min: 8, max: 14, avg: 11, color: 'var(--accent-green)' },
            { name: 'Overhead Conductors', size: 'ACSR/HTLS', min: 4, max: 12, avg: 8, color: 'var(--accent-green)' },
        ];
        
        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                item.classList.add('active');
                document.getElementById(item.dataset.tab).classList.add('active');
            });
        });
        
        // Filter tabs
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                renderEquipmentGrid(tab.dataset.filter);
            });
        });
        
        // Render Equipment Grid
        function renderEquipmentGrid(filter = 'all') {
            const container = document.getElementById('equipment-grid');
            container.innerHTML = '';
            
            const filtered = filter === 'all' ? equipmentData : equipmentData.filter(e => e.category === filter);
            
            filtered.forEach(equip => {
                const card = document.createElement('div');
                card.className = 'equipment-card';
                
                const importClass = equip.import >= 70 ? 'critical' : equip.import >= 40 ? 'high' : 'low';
                
                card.innerHTML = `
                    <div class="equipment-header">
                        <div class="equipment-name">${equip.name}</div>
                        <span class="import-badge ${importClass}">${equip.import}% Import</span>
                    </div>
                    <div class="equipment-meta">
                        <span class="equipment-tag">${equip.size}</span>
                        <span class="equipment-tag">${equip.category}</span>
                    </div>
                    <div class="equipment-stats">
                        <div class="equipment-stat">
                            <div class="equipment-stat-value">${equip.market}</div>
                            <div class="equipment-stat-label">US Market</div>
                        </div>
                        <div class="equipment-stat">
                            <div class="equipment-stat-value" style="color: ${equip.leadAvg >= 30 ? 'var(--accent-red)' : equip.leadAvg >= 18 ? 'var(--accent-yellow)' : 'var(--accent-green)'}">${equip.leadAvg}</div>
                            <div class="equipment-stat-label">Months Lead</div>
                        </div>
                        <div class="equipment-stat">
                            <div class="equipment-stat-value">${equip.leadTime}</div>
                            <div class="equipment-stat-label">Range</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // Render Lead Times Chart
        function renderLeadTimes() {
            const container = document.getElementById('lead-times-chart');
            const maxTime = 55;
            
            leadTimeData.forEach(item => {
                const row = document.createElement('div');
                row.className = 'lead-time-row';
                const width = (item.avg / maxTime) * 100;
                
                row.innerHTML = `
                    <div class="lead-time-label">${item.name}<small>${item.size}</small></div>
                    <div class="lead-time-track">
                        <div class="lead-time-segment" style="width: ${width}%; background: ${item.color};"><span>${item.avg} mo</span></div>
                    </div>
                    <div class="lead-time-value">${item.min}-${item.max}</div>
                `;
                container.appendChild(row);
            });
        }
        
        // Treemap helper
        function renderTreemap(containerId, data, width, height) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const svg = d3.select(`#${containerId}`)
                .append('svg')
                .attr('width', '100%')
                .attr('height', height)
                .attr('viewBox', `0 0 ${width} ${height}`);
            
            const root = d3.hierarchy({children: data})
                .sum(d => d.value);
            
            d3.treemap()
                .size([width, height])
                .padding(3)
                (root);
            
            const cells = svg.selectAll('g')
                .data(root.leaves())
                .join('g')
                .attr('transform', d => `translate(${d.x0},${d.y0})`);
            
            cells.append('rect')
                .attr('class', 'treemap-cell')
                .attr('width', d => d.x1 - d.x0)
                .attr('height', d => d.y1 - d.y0)
                .attr('fill', d => d.data.color)
                .attr('rx', 4);
            
            cells.append('text')
                .attr('class', 'treemap-label')
                .attr('x', 8)
                .attr('y', 20)
                .text(d => d.data.name)
                .style('font-weight', '600');
            
            cells.append('text')
                .attr('class', 'treemap-label')
                .attr('x', 8)
                .attr('y', 36)
                .text(d => `${d.data.value}%`)
                .style('font-family', 'Geist Mono, monospace')
                .style('opacity', 0.8);
        }
        
        // Market Flow Sankey
        function renderMarketSankey() {
            const container = document.getElementById('market-sankey');
            if (!container) return;
            
            const width = container.clientWidth || 900;
            const height = 380;
            
            const svg = d3.select('#market-sankey')
                .append('svg')
                .attr('width', '100%')
                .attr('height', height)
                .attr('viewBox', `0 0 ${width} ${height}`);
            
            const nodes = [
                {name: "US Grid Market\n$85B"},
                {name: "Transformers\n$28B"},
                {name: "Switchgear\n$22B"},
                {name: "Cables\n$18B"},
                {name: "Components\n$12B"},
                {name: "Domestic\n$31.5B"},
                {name: "Imported\n$53.5B"}
            ];
            
            const links = [
                {source: 0, target: 1, value: 28},
                {source: 0, target: 2, value: 22},
                {source: 0, target: 3, value: 18},
                {source: 0, target: 4, value: 12},
                {source: 1, target: 5, value: 8},
                {source: 1, target: 6, value: 20},
                {source: 2, target: 5, value: 6},
                {source: 2, target: 6, value: 16},
                {source: 3, target: 5, value: 12},
                {source: 3, target: 6, value: 6},
                {source: 4, target: 5, value: 4},
                {source: 4, target: 6, value: 8}
            ];
            
            const sankey = d3.sankey()
                .nodeWidth(20)
                .nodePadding(24)
                .extent([[1, 1], [width - 1, height - 6]]);
            
            const {nodes: sankeyNodes, links: sankeyLinks} = sankey({
                nodes: nodes.map(d => ({...d})),
                links: links.map(d => ({...d}))
            });
            
            const colorScale = d3.scaleOrdinal()
                .domain(["US Grid Market", "Transformers", "Switchgear", "Cables", "Components", "Domestic", "Imported"])
                .range(["#3b82f6", "#22d3ee", "#10b981", "#f59e0b", "#a855f7", "#10b981", "#f97316"]);
            
            svg.append('g')
                .selectAll('path')
                .data(sankeyLinks)
                .join('path')
                .attr('class', 'sankey-link')
                .attr('d', d3.sankeyLinkHorizontal())
                .attr('stroke', d => d.target.name.includes('Domestic') ? '#10b981' : d.target.name.includes('Imported') ? '#f97316' : colorScale(d.source.name.split('\n')[0]))
                .attr('stroke-width', d => Math.max(1, d.width));
            
            const node = svg.append('g')
                .selectAll('g')
                .data(sankeyNodes)
                .join('g')
                .attr('class', 'sankey-node');
            
            node.append('rect')
                .attr('x', d => d.x0)
                .attr('y', d => d.y0)
                .attr('height', d => d.y1 - d.y0)
                .attr('width', d => d.x1 - d.x0)
                .attr('fill', d => colorScale(d.name.split('\n')[0]))
                .attr('rx', 3);
            
            node.append('text')
                .attr('x', d => d.x0 < width / 2 ? d.x1 + 8 : d.x0 - 8)
                .attr('y', d => (d.y1 + d.y0) / 2)
                .attr('dy', '0.35em')
                .attr('text-anchor', d => d.x0 < width / 2 ? 'start' : 'end')
                .text(d => d.name.split('\n')[0])
                .style('font-size', '12px')
                .style('fill', '#fafafa')
                .style('font-weight', '500');
            
            node.append('text')
                .attr('x', d => d.x0 < width / 2 ? d.x1 + 8 : d.x0 - 8)
                .attr('y', d => (d.y1 + d.y0) / 2 + 14)
                .attr('text-anchor', d => d.x0 < width / 2 ? 'start' : 'end')
                .text(d => d.name.split('\n')[1] || '')
                .style('font-size', '11px')
                .style('fill', '#6a6a6a')
                .style('font-family', 'Geist Mono, monospace');
        }
        
        // Equipment Supply Sankey
        function renderEquipmentSankey() {
            const container = document.getElementById('equipment-sankey');
            if (!container || container.querySelector('svg')) return;
            
            const width = container.clientWidth || 800;
            const height = 350;
            
            const svg = d3.select('#equipment-sankey')
                .append('svg')
                .attr('width', '100%')
                .attr('height', height)
                .attr('viewBox', `0 0 ${width} ${height}`);
            
            const nodes = [
                {name: "USA Domestic"},
                {name: "Mexico"},
                {name: "Germany"},
                {name: "Japan"},
                {name: "South Korea"},
                {name: "LPT Pool"},
                {name: "IOUs"},
                {name: "Public Power"},
                {name: "Industrial"},
                {name: "Renewables/IPP"}
            ];
            
            const links = [
                {source: 0, target: 5, value: 25},
                {source: 1, target: 5, value: 22},
                {source: 2, target: 5, value: 18},
                {source: 3, target: 5, value: 15},
                {source: 4, target: 5, value: 12},
                {source: 5, target: 6, value: 41},
                {source: 5, target: 7, value: 16},
                {source: 5, target: 8, value: 18},
                {source: 5, target: 9, value: 17}
            ];
            
            const sankey = d3.sankey()
                .nodeWidth(18)
                .nodePadding(18)
                .extent([[1, 1], [width - 1, height - 6]]);
            
            const {nodes: sankeyNodes, links: sankeyLinks} = sankey({
                nodes: nodes.map(d => ({...d})),
                links: links.map(d => ({...d}))
            });
            
            const colors = {
                "USA Domestic": "#10b981",
                "Mexico": "#f59e0b",
                "Germany": "#3b82f6",
                "Japan": "#ec4899",
                "South Korea": "#a855f7",
                "LPT Pool": "#64748b",
                "IOUs": "#22d3ee",
                "Public Power": "#22d3ee",
                "Industrial": "#22d3ee",
                "Renewables/IPP": "#22d3ee"
            };
            
            svg.append('g')
                .selectAll('path')
                .data(sankeyLinks)
                .join('path')
                .attr('class', 'sankey-link')
                .attr('d', d3.sankeyLinkHorizontal())
                .attr('stroke', d => colors[d.source.name])
                .attr('stroke-width', d => Math.max(1, d.width));
            
            const node = svg.append('g')
                .selectAll('g')
                .data(sankeyNodes)
                .join('g')
                .attr('class', 'sankey-node');
            
            node.append('rect')
                .attr('x', d => d.x0)
                .attr('y', d => d.y0)
                .attr('height', d => d.y1 - d.y0)
                .attr('width', d => d.x1 - d.x0)
                .attr('fill', d => colors[d.name])
                .attr('rx', 3);
            
            node.append('text')
                .attr('x', d => d.x0 < width / 2 ? d.x1 + 8 : d.x0 - 8)
                .attr('y', d => (d.y1 + d.y0) / 2)
                .attr('dy', '0.35em')
                .attr('text-anchor', d => d.x0 < width / 2 ? 'start' : 'end')
                .text(d => d.name)
                .style('font-size', '12px')
                .style('fill', '#fafafa');
        }
        
        // GOES Sankey
        function renderGoesSankey() {
            const container = document.getElementById('goes-sankey');
            if (!container || container.querySelector('svg')) return;
            
            const width = container.clientWidth || 600;
            const height = 200;
            
            const svg = d3.select('#goes-sankey')
                .append('svg')
                .attr('width', '100%')
                .attr('height', height)
                .attr('viewBox', `0 0 ${width} ${height}`);
            
            const nodes = [
                {name: "Japan"},
                {name: "S. Korea"},
                {name: "USA"},
                {name: "China"},
                {name: "US Transformers"}
            ];
            
            const links = [
                {source: 0, target: 4, value: 40},
                {source: 1, target: 4, value: 22},
                {source: 2, target: 4, value: 30},
                {source: 3, target: 4, value: 8}
            ];
            
            const sankey = d3.sankey()
                .nodeWidth(16)
                .nodePadding(12)
                .extent([[1, 1], [width - 1, height - 6]]);
            
            const {nodes: sankeyNodes, links: sankeyLinks} = sankey({
                nodes: nodes.map(d => ({...d})),
                links: links.map(d => ({...d}))
            });
            
            const colors = ["#ec4899", "#a855f7", "#10b981", "#f59e0b", "#64748b"];
            
            svg.append('g')
                .selectAll('path')
                .data(sankeyLinks)
                .join('path')
                .attr('class', 'sankey-link')
                .attr('d', d3.sankeyLinkHorizontal())
                .attr('stroke', (d, i) => colors[d.source.index])
                .attr('stroke-width', d => Math.max(1, d.width));
            
            const node = svg.append('g')
                .selectAll('g')
                .data(sankeyNodes)
                .join('g')
                .attr('class', 'sankey-node');
            
            node.append('rect')
                .attr('x', d => d.x0)
                .attr('y', d => d.y0)
                .attr('height', d => d.y1 - d.y0)
                .attr('width', d => d.x1 - d.x0)
                .attr('fill', (d, i) => colors[i])
                .attr('rx', 2);
            
            node.append('text')
                .attr('x', d => d.x0 < width / 2 ? d.x1 + 6 : d.x0 - 6)
                .attr('y', d => (d.y1 + d.y0) / 2)
                .attr('dy', '0.35em')
                .attr('text-anchor', d => d.x0 < width / 2 ? 'start' : 'end')
                .text(d => d.name)
                .style('font-size', '11px')
                .style('fill', '#fafafa');
        }
        
        // Import Dependency Treemap
        function renderImportTreemap() {
            const data = [
                {name: "Switchgear 73%", value: 73, color: "#f97316"},
                {name: "Transformers 71%", value: 71, color: "#ef4444"},
                {name: "Materials 70%", value: 70, color: "#ef4444"},
                {name: "Components 67%", value: 67, color: "#f59e0b"},
                {name: "Cables 33%", value: 33, color: "#10b981"}
            ];
            renderTreemap('import-treemap', data, 500, 280);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderMarketSankey();
            renderImportTreemap();
            renderEquipmentGrid();
            renderLeadTimes();
            
            // Render equipment sankey when tab is shown
            document.querySelector('[data-tab="equipment"]').addEventListener('click', () => {
                setTimeout(renderEquipmentSankey, 100);
            });
            
            // Render GOES sankey when materials tab is shown
            document.querySelector('[data-tab="materials"]').addEventListener('click', () => {
                setTimeout(renderGoesSankey, 100);
            });
        });
        
        // Handle resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                document.querySelectorAll('.sankey-container svg, .treemap-container svg').forEach(svg => svg.remove());
                renderMarketSankey();
                renderImportTreemap();
            }, 250);
        });
    </script>
</body>
</html>
